# 09. SanBot 实施蓝图：里程碑、验收指标与风险控制

本篇把前 8 篇的理念转成一套可执行路线图，帮助 SanBot 从概念过渡到工程闭环。聚焦三类输出：阶段划分、里程碑验收、风险监控。

## 一、阶段划分（Phased Delivery）

| 阶段 | 核心目标 | 成果物 | 验收指标 |
| --- | --- | --- | --- |
| Phase 0 - 环境与基线 | 建好 `exec + session + permissions` 的最小运行环境 | CLI/接口原型、权限策略文档、失败恢复机制说明 | 能稳定执行指令并恢复（成功率 ≥95%，发生错误可回滚） |
| Phase 1 - Agent Loop MVP | 跑通 `Gather→Act→Verify` 的闭环，覆盖最小业务场景（例如：执行 shell、生成脚本、复用工具） | Agent Loop 流程文档、工具清单、自动化测试集 | 任务成功率 ≥70%，每次迭代有验证日志和失败定位信息 |
| Phase 2 - Context & Memory | 加入上下文治理能力：compaction、子代理、Memory files（或等价机制） | 子代理模板、上下文策略说明、Memory 管理策略 | 长任务成功率提升 ≥15%，上下文溢出率 <5%，有 Memory 使用案例 |
| Phase 3 - Ecosystem Integration | 接入 MCP / 外部工具 + 自研高层业务工具，形成“标准协议 + 业务封装” | MCP 接入清单、工具 ABI 文档、权限控制流程 | 新增集成上线时间 <1 周，关键动作全程可审计 |
| Phase 4 - Eval-driven Autonomy | 建立评测管线、自工具生成闭环和策略回归体系 | Eval 套件、失败归因机制、回归报告模板 | 每次能力迭代可量化收益，Holdout 成功率持续提升，失败样本有闭环跟踪 |

## 二、关键里程碑与验收指标

### M0 - 环境准备完成
- `指令执行成功率 ≥95%`
- `权限误触发率 <2%`
- `失败可恢复（日志 + 回滚机制）`

### M1 - Loop MVP 可运行
- 至少 1 个 MVP 任务（如“执行命令 + 生成脚本 + 验证”）闭环跑通。
- `任务成功率 ≥70%`。
- 有可读的 Loop 审计日志（每轮行动、原因、结果）。

### M2 - Context 改造就绪
- Compaction 策略验证：上下文溢出率显著下降。
- 子代理实践：独立任务可由子代理完成且输出摘要。
- Memory 机制上线，并在至少两个场景成功复用经验。

### M3 - Ecosystem Ready
- MCP / 工具封装标准化落地，新增系统可快速接入。
- 每个 MCP server 都有权限边界与审计策略。
- 业务动作通过高层工具暴露，模型无需逐条调用底层 API。

### M4 - Eval-driven 运营
- 建成覆盖真实任务的多层评测集（基础 + 复杂 + holdout）。
- 每次工具/策略变更都能跑回归并得到量化指标。
- 自工具生成和策略调优纳入评测闭环（未通过评测不得上线）。

## 三、风险矩阵与缓解策略

| 风险 | 触发信号 | 缓解策略 |
| --- | --- | --- |
| Core loop 不稳定 | 成功率无规律波动、验证缺失 | 优先投入 Phase 1：把 Loop 做扎实，先暂停新特性 |
| 权限/安全事故 | 命令滥用、数据外泄 | 最小权限 + 人工确认 + 审计日志，风险动作上链 |
| 上下文失控 | 成本攀升、上下文溢出、子代理噪音 | 严格执行 compaction 策略、子代理只回摘要、引入 memory 持久层 |
| 集成拖垮迭代 | 新工具接入时间过长、质量不一 | MCP + 业务工具双层封装，设立集成 checklist |
| 无法量化改进 | 团队争论无结论、上线后质量不稳 | Eval pipeline 作为 “gate”，回归不通过不得上线 |

## 四、运营节奏建议
1. **双周节奏**：每两周固定节点评测 + 迭代计划评审。
2. **失败样本常规化**：失败案例必须进入知识库（Memory）并转化为评测题。
3. **工具演进看板**：每个工具的使用情况、错误率、改动记录纳入同一看板。
4. **风险审计日**：每月一次对权限、日志、失败恢复能力做抽查。

## 五、SanBot 的落地心法
1. **先闭环，后扩展**：Loop 是地基，没跑通之前不引入高复杂度。
2. **Context 先治理，再谈长程自治**：上下文乱，所有优化都是噪音。
3. **工具是 Prompt 的一部分**：工具设计质量决定 agent 行为质量。
4. **评测是运营手段**：评测体系建设度 = 自主能力成熟度。

## Checklist（实施自检）
- 阶段目标、成果物、指标是否已对齐？
- 是否为每个阶段定义了“上线门槛”和“退出条件”？
- 是否有统一的风险监控与回归机制？
- 是否确保 Loop、Context、Integration、Eval 四条线协同推进？
